---
title: "EDA_xia"
author: "ShufanXia"
date: "9/23/2021"
output: html_document
---
load library
```{r}
library(stargazer)
#library(tidyverse)
library(ggplot2)
library(arm)
library(pROC)
library(caret)
library(e1071)
library(GGally)

```

```{r setup, include=FALSE}
wages <- read.table("./Data//lalondedata.txt",sep=",",header=TRUE)
summary(wages)
wages$nonZero78 <- ifelse(wages$re78 > 0,1,0)
wages$nonZero78_fac <-factor(wages$nonZero78,levels=c(0,1),labels=c("Zero","Non-zero"))
wages$treat_fac <-factor(wages$treat,levels=c(0,1),labels=c("Not-treated","Treated"))
wages$black_fac <- factor(wages$black,levels=c(0,1),labels=c("Not Black","Black"))
wages$hispan_fac <- factor(wages$hispan,levels=c(0,1),labels=c("Not Hispanic","Hispanic"))
wages$married_fac <- factor(wages$married,levels=c(0,1),labels=c("Unmarried","Married"))
wages$nodegree_fac <- factor(wages$nodegree,levels=c(0,1),labels=c("degree","nodegree"))

wages$raceother <- wages$black==0 &wages$hispan==0
wages$raceother <- ifelse(wages$raceother,1,0)
wages$raceother_fac <-factor(wages$raceother,levels=c(0,1),labels=c("Black or Hispanic","Other race"))

wages$age_c <- wages$age-mean(wages$age)
## total 614, black 243, hispanic 72, other race 299
```

#PART 
#I Is there evidence that workers who receive job training tend to earn higher wages than workers who do not receive job training?
#Linear regression
```{r}
# distribution of the reponse variable

hist(wages$re78,xlab="wage in 1978 (oz)",main="Distribution of wage in 1978",col=rainbow(10))
#not normal, take log
wages$logre78 <- log(wages$re78)
hist(wages$logre78,xlab="wage in 1978 (oz)",main="Distribution of log wage in 1978",col=rainbow(10))
```

```{r}
# categorical variable: training
ggplot(wages, aes(x=treat_fac,y=re78, fill=re78))+
  geom_boxplot()+
  scale_fill_brewer(palette = "Reds")+
  labs(title="wage in 1978 vs training",
       x="Training ", y="wage in 78")

# categorical variable: raceBlack
ggplot(wages, aes(x=black_fac,y=re78, fill=re78))+
  geom_boxplot()+
  scale_fill_brewer(palette = "Reds")+
  labs(title="wage in 1978 vs Black",
       x="Black", y="wage in 78")

# categorical variable: raceHispanic
ggplot(wages, aes(x=hispan_fac,y=re78, fill=re78))+
  geom_boxplot()+
  scale_fill_brewer(palette = "Reds")+
  labs(title="wage in 1978 vs Hispanic",
       x="Hispanic", y="wage in 78")

ggplot(wages, aes(x=raceother_fac,y=re78, fill=re78))+
  geom_boxplot()+
  scale_fill_brewer(palette = "Reds")+
  labs(title="wage in 1978 vs other races",
       x="other races", y="wage in 78")

ggplot(wages, aes(x=married_fac,y=re78, fill=re78))+
  geom_boxplot()+
  scale_fill_brewer(palette = "Reds")+
  labs(title="wage in 1978 vs Married",
       x="married", y="wage in 78")

ggplot(wages, aes(x=nodegree_fac,y=re78, fill=re78))+
  geom_boxplot()+
  scale_fill_brewer(palette = "Reds")+
  labs(title="wage in 1978 vs with high school degree",
       x="high school degree", y="wage in 78")

```
```{r} 
# interaction between categorical variables

```
```{r}
# numerical variable: age
ggplot(wages,aes(x=age_c,y=logre78))+ geom_point()+geom_smooth(method="lm",col="red3")+labs(title="wage78 VS age centered",y="wage78",x="age")

ggplot(wages,aes(x=age_c,y=logre78))+ geom_point()+geom_smooth(method="lm",col="red3")+labs(title="wage78 VS age centered by treatment",y="log(wage78)",x="age centered") +facet_wrap(~treat_fac)

# numerical variable: education year
ggplot(wages,aes(x=educ,y=logre78))+ geom_point()+geom_smooth(method="lm",col="red3")+labs(title="wage78 VS education years",y="wage78",x="educaiton year")

ggplot(wages,aes(x=educ,y=logre78))+ geom_point()+geom_smooth(method="lm",col="red3")+labs(title="wage78 VS education years by training",y="log(wage78)",x="education year") +facet_wrap(~treat_fac)


# numerical variable: re74
ggplot(wages,aes(x=re74,y=logre78))+ geom_point()+geom_smooth(method="lm",col="red3")+labs(title="wage78 VS wage74",y="log(wage78)",x="wage74")

ggplot(wages,aes(x=re74,y=logre78))+ geom_point()+geom_smooth(method="lm",col="red3")+labs(title="wage78 VS wage74 by training",y="log(wage78)",x="wage74") +facet_wrap(~treat_fac)

# numerical variable: re75
ggplot(wages,aes(x=re75,y=logre78))+ geom_point()+geom_smooth(method="lm",col="red3")+labs(title="wage78 VS wage74",y="log(wage78)",x="wage75")

ggplot(wages,aes(x=re75,y=logre78))+ geom_point()+geom_smooth(method="lm",col="red3")+labs(title="wage78 VS wage75 by training",y="log(wage78)",x="wage75") +facet_wrap(~treat_fac)

```



### part 2
```{r}
countBYtraining <- table(wages[,c("nonZero78_fac","treat_fac")])
countBYtraining
jointProb_training <- table(wages[,c("nonZero78_fac","treat_fac")])/sum(countBYtraining)
conditionalProb_training <- apply(jointProb_training, 2, function(x) x/sum(x))
conditionalProb_training
chisq.test(countBYtraining)

countBYblack <- table(wages[,c("nonZero78_fac","black_fac")])
countBYblack
jointProb_black <- countBYblack/sum(countBYblack)
conditionalProb_black <- apply(jointProb_black, 2, function(x) x/sum(x))
conditionalProb_black
chisq.test(countBYblack)

countBYhispan <- table(wages[,c("nonZero78_fac","hispan_fac")])
countBYhispan
jointProb_hispan <- countBYhispan/sum(countBYhispan)
conditionalProb_hispan <- apply(jointProb_hispan, 2, function(x) x/sum(x))
conditionalProb_hispan
chisq.test(countBYhispan)

countBYraceother <- table(wages[,c("nonZero78_fac","raceother_fac")])
countBYraceother
jointProb_raceother <- countBYraceother/sum(countBYraceother)
conditionalProb_raceother <- apply(jointProb_raceother, 2, function(x) x/sum(x))
conditionalProb_raceother
chisq.test(countBYraceother)

countBYnodegree <- table(wages[,c("nonZero78_fac","nodegree_fac")])
countBYnodegree
jointProb_nodegree <- countBYnodegree/sum(countBYnodegree)
conditionalProb_nodegree<- apply(jointProb_nodegree, 2, function(x) x/sum(x))
conditionalProb_nodegree
chisq.test(countBYnodegree)

countBYmarried <- table(wages[,c("nonZero78_fac","married_fac")])
countBYmarried
jointProb_married <- countBYmarried/sum(countBYmarried)
conditionalProb_married <- apply(jointProb_married, 2, function(x) x/sum(x))
conditionalProb_married
chisq.test(countBYmarried)
```

```{r}
#numerical variable
binnedplot(y=wages$nonZero78,x=wages$age_c,xlab="age centered",ylab="zero wage 78",ylim=c(0,1),main = "zero wage 78 vs age centered")

binnedplot(y=wages$nonZero78,x=wages$educ,xlab="education year",ylab="zero wage 78",ylim=c(0,1),main = "zero wage 78 vs education year")

binnedplot(y=wages$nonZero78,x=wages$re74,xlab="wage 74",ylab="zero wage 78",ylim=c(0,1),main = "zero wage 78 vs wage in 74")

binnedplot(y=wages$nonZero78,x=wages$re75,xlab="wage 75",ylab="zero wage 78",ylim=c(0,1),main = "zero wage 78 vs wage in 75")

```

```{r}


```